Reservoir Sampling
===========================

你想知道水的平均酸碱度，你能怎么办，所有的水的酸碱度相加在一起，再除以水的体积，这个对于一个游泳池没问题，但是对于一条奔涌不息的大河，这个方法显然没办法，只能采样，用一个蓄水池把采样的水贮存在一起。这样你仍然用可以传统的方法来计算统计值。

平均值是比较好算的，分位值更加难算，99%的水样酸碱度，需要把每份水样排序，再确定99%的值不会超过多少。

举个实际点的例子，API 的响应时间，每次调用的时间不可能全部保存下来，有两个重要问题要讨论：

1) 采样集合的大小
2) 采样集合的更新方法

常用的采样算法
--------------------
1. Uniform Reservoirs
当采样集未满时，直接向采样集中增加。采样集满时，随机替换数组的第 i 个元素。

2. Sliding Window Reservoirs
数组未满，向后累加；数组满，从第一个开始覆盖

3. Sliding Time Window Reservoirs
采样集的数据是最近 N 秒的数据

采样集：key 是时间，value 是事件值的 Map。
采样集数据更新原则：只保存最近 N 秒的值。

4. Exponentially Decaying Reservoirs
指数衰减采样集算法。 同样记录最近时间段的事件值，每个事件值都映射一个权重值，时间越近，权重值越大

参考阅读
--------------
* https://metrics.dropwizard.io/4.1.2/manual/core.html
* http://younghz.github.io/metrics

