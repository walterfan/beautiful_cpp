<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kafka &mdash; A Programmer Prepares 0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Cassandra" href="cassandra.html" />
    <link rel="prev" title="Middleware" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> A Programmer Prepares
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">论程序员的自我修养</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interview.html">程序员面试要点</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resume.html">Resume</a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithm/index.html">Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture/index.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/index.html">Programming Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../library/index.html">Libraries</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Middleware</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Kafka</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#concepts">Concepts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#topic">Topic</a></li>
<li class="toctree-l4"><a class="reference internal" href="#partition">Partition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#segment">Segment</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#terminology">Terminology</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mirror-maker">Mirror Maker</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cassandra.html">Cassandra</a></li>
<li class="toctree-l2"><a class="reference internal" href="redis.html">Redis</a></li>
<li class="toctree-l2"><a class="reference internal" href="freeswitch.html">Freeswitch</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#metrics">Metrics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../math/index.html">mathematics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../math/index.html#overview">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../math/index.html#least-squares-method">最小二乘法 least squares method</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pattern/index.html">Pattern</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platform/index.html">Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tool/index.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mmp/index.html">MMP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thinclient/index.html">Thin Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utiltp/index.html">UTILTP</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">A Programmer Prepares</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Middleware</a> &raquo;</li>
      <li>Kafka</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/oss/kafka.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="kafka">
<h1>Kafka<a class="headerlink" href="#kafka" title="Permalink to this headline"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id1">Overview</a></p></li>
<li><p><a class="reference internal" href="#concepts" id="id2">Concepts</a></p>
<ul>
<li><p><a class="reference internal" href="#topic" id="id3">Topic</a></p></li>
<li><p><a class="reference internal" href="#partition" id="id4">Partition</a></p></li>
<li><p><a class="reference internal" href="#segment" id="id5">Segment</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#terminology" id="id6">Terminology</a></p></li>
<li><p><a class="reference internal" href="#mirror-maker" id="id7">Mirror Maker</a></p></li>
</ul>
</div>
<section id="overview">
<h2><a class="toc-backref" href="#id1">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>以时间复杂度为O(1)的方式提供消息持久化能力，即使对TB级以上数据也能保证常数时间复杂度的访问性能</p></li>
<li><p>高吞吐率。即使在非常廉价的商用机器上也能做到单机支持 每秒100K条以上消息的传输</p></li>
<li><p>支持 Kafka Broker间的消息分区，及分布式消费，同时保证每个Partition内的消息顺序传输</p></li>
<li><p>同时支持离线数据处理和实时数据处理</p></li>
<li><p>水平扩展:支持在线水平扩展</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/kafka-overview.jpg"><img alt="alternate text" class="align-center" src="../_images/kafka-overview.jpg" style="width: 1238.0px; height: 822.0px;" /></a>
<p>..code-block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="n">ZooKeeper</span>
            <span class="o">^</span>
            <span class="o">|</span>
<span class="n">Producer</span> <span class="o">--&gt;</span> <span class="n">Broker</span> <span class="o">--&gt;</span> <span class="n">Consumer</span>
</pre></div>
</div>
</section>
<section id="concepts">
<h2><a class="toc-backref" href="#id2">Concepts</a><a class="headerlink" href="#concepts" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Topic</p></li>
<li><p>Partition: ~ 文件夹</p></li>
<li><p>Segment： ~ 文件</p>
<ul>
<li><p>数据文件</p></li>
<li><p>offset 索引文件</p></li>
<li><p>时间索引文件</p></li>
</ul>
</li>
<li><p>Meta data</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>Broker</p></li>
<li><p>Topic</p></li>
<li><p>Partition</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>Retention</p></li>
<li><p>Compaction</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>log.cleanup.policy=delete/Compact</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>Topic 的分区
例如根据 key_hash % 分区数量</p></li>
</ul>
<section id="topic">
<h3><a class="toc-backref" href="#id3">Topic</a><a class="headerlink" href="#topic" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>逻辑概念</p></li>
<li><p>发布-订阅均基于 Topic</p></li>
</ul>
</section>
<section id="partition">
<h3><a class="toc-backref" href="#id4">Partition</a><a class="headerlink" href="#partition" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>一个Topic包含一个或多个Partition, 每个Paratitio 物理上对应一个文件夹</p></li>
<li><p>Partition可认为是一个无限长度数组</p></li>
</ul>
</section>
<section id="segment">
<h3><a class="toc-backref" href="#id5">Segment</a><a class="headerlink" href="#segment" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>一个Partition包含若干个Segment</p></li>
<li><p>物理上每个Segment对应一个数据文件，一个offset索引文件，一个时间索引文件</p></li>
</ul>
</section>
</section>
<section id="terminology">
<h2><a class="toc-backref" href="#id6">Terminology</a><a class="headerlink" href="#terminology" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Records are published into Kafka topics, or logical categories of records, similar to queues in RabbitMQ, indices in ES, etc.</p></li>
<li><p>Producers write to a topic in Kafka, and consumers read from a topic.</p></li>
<li><p>Each topic is broken into multiple “partitions” that can be distributed across multiple nodes and replicated for data redundancy.</p></li>
<li><p>For each partition, one Kafka broker acts as the “leader”, meaning it handles all read and write requests for that partition. If there are multiple copies of this partition, all other servers that hold these replica partitions act as “followers” that passively replicate the leader; if a leader fails, one of the eligible followers automatically becomes the new leader (see next bullet).</p></li>
<li><p>“ISR” (“in-sync” replicas) refers to the set of replica partitions that are caught-up to the leader. Only these caught-up replicas are eligible to become the new leader in case of leader failure.</p></li>
<li><p>Each partition is an ordered, immutable sequence of records; each record is sequentially assigned a unique id number known as its offset value.</p></li>
<li><p>Each consumer uses the “offset” value of its most recently read record to track its position on the partition it is “consuming”.</p></li>
<li><p>Consumer “lag” is the difference between the highest partition offset (i.e. most recently written record) and the consumer’s current offset, and thus represents the number of unread records.</p></li>
<li><p>Mirrormaker is a cross-cluster replication tool provided by the Apache Kafka platform. It consumes messags from a source Kafka cluster and produces those messages into a sink Kafka cluster.</p></li>
</ul>
</section>
<section id="mirror-maker">
<h2><a class="toc-backref" href="#id7">Mirror Maker</a><a class="headerlink" href="#mirror-maker" title="Permalink to this headline"></a></h2>
<p>We leverage Kafka’s MirrorMakers to support cross-site replication (aka “mirroring”) for relevant topics.</p>
<p>MirrorMakers are essentially Kafka consumers and producers that read data from a source Kafka cluster and produce that data into a sink Kafka clusters.</p>
<p>These source and sink Kafka clusters are completely separate entities, and consumer offsets in the source and sink clusters will be different</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Middleware" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="cassandra.html" class="btn btn-neutral float-right" title="Cassandra" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Walter Fan.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>